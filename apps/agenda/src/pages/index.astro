---
export const prerender = false;

import { readItems } from "@directus/sdk";
import Layout from "../layouts/Layout.astro";
import { getDirectusClient } from "../lib/directus";
import AgendaTable from "../components/AgendaTable.svelte";

const token = Astro.locals.token;

const client = getDirectusClient(token);
const initialReservations = await client.request(
  readItems("reservations", {
    // filter: { date: { _eq: new Date().toISOString().split('T')[0] }},
    sort: ["time"],
  })
);

const tokenExpiry = Date.now() + 15 * 60 * 1000;
---

<Layout title="Agenda">
  <AgendaTable
    client:load
    token={token}
    tokenExpiry={tokenExpiry}
    initialData={initialReservations}
  />
</Layout>
