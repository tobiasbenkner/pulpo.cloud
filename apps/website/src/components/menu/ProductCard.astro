---
import type { CollectionEntry } from "astro:content";
import { t } from "../../utils/t";
import { Image } from "astro:assets";

type Product = CollectionEntry<"categories">["data"]["products"][0];

interface Props {
  product: Product;
  lang: CollectionEntry<"languages">["data"];
}
const { product, lang } = Astro.props;

const name = t(product.name, lang.code);
const description = t(product.description, lang.code);
const note = t(product.note, lang.code);

function formatPrice(price: number) {
  return new Intl.NumberFormat(lang.code, {
    style: "currency",
    currency: "EUR",
  }).format(price);
}
---

<article class="border-b border-border/30 pb-8 contain-content">
  <div class="flex items-start gap-6">
    <div class="grow">
      <h3 class="text-2xl font-bold text-foreground">{name}</h3>

      {
        description && (
          <div class="mt-2 text-muted-foreground">
            <Fragment set:html={description} />
          </div>
        )
      }

      {
        note && (
          <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-amber-200 text-primary-foreground">
            {note}
          </span>
        )
      }

      <div class="mt-4 flex flex-wrap items-center gap-2">
        {
          product.allergies?.map((allergy) => (
            <Image
              src={`/icons/allergies/2/${allergy}.svg`}
              alt={`${allergy}`}
              title={allergy}
              decoding="async"
              loading="lazy"
              width="28"
              height="28"
              class="w-7 h-7"
            />
          ))
        }
      </div>
    </div>

    <div class="shrink-0 w-32 text-center">
      {
        product.image && (
          <Image
            src={product.image.src}
            alt={t(product.name, lang.code)}
            width={192}
            height={192}
            decoding="async"
            loading="lazy"
            class="w-24 h-24 rounded-full object-cover mx-auto will-change-transform bg-gray-100"
          />
        )
      }
      <p class="mt-4 font-semibold text-foreground">
        {
          typeof product.price === "number"
            ? formatPrice(product.price / 100)
            : ""
        }
      </p>
    </div>
  </div>
</article>
