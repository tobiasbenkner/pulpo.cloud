---
import { languages, defaultLang, type Language } from '@/lib/types';
import { getTranslatedPath } from '@/lib/registry';
import { siteData } from '@/data/siteData';

interface Props {
  title: string;
  description: string;
  lang: Language;
  routeKey: string;
  ogImage?: string;
  noindex?: boolean;
}

const { title, description, lang, routeKey, ogImage, noindex = false } = Astro.props;
const baseUrl = Astro.site?.toString().replace(/\/$/, '') || 'http://localhost:4321';
const canonicalURL = `${baseUrl}${getTranslatedPath(routeKey, lang)}`;
const ogImageUrl = new URL(ogImage || '/og-default.png', baseUrl).toString();
const robotsContent = noindex ? 'noindex, nofollow' : 'index, follow';

const alternateLinks = languages.map(l => ({
  lang: l,
  href: `${baseUrl}${getTranslatedPath(routeKey, l)}`,
}));
---
<title>{title}</title>
<meta name="description" content={description} />
<meta name="robots" content={robotsContent} />
<link rel="canonical" href={canonicalURL} />

<!-- Language Alternates -->
<link rel="alternate" hreflang="x-default" href={`${baseUrl}${getTranslatedPath(routeKey, defaultLang)}`} />
{alternateLinks.map(link => <link rel="alternate" hreflang={link.lang} href={link.href} />)}

<!-- Open Graph -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:site_name" content={siteData.meta.name} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:type" content="website" />
<meta property="og:locale" content={lang === 'de' ? 'de_DE' : lang === 'en' ? 'en_US' : 'es_ES'} />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageUrl} />
<meta name="twitter:site" content={siteData.meta.twitterHandle} />