---
import { languages, defaultLang } from "@/lib/i18n";
import { routeSlugs, getView } from "@/lib/registry"; // Import getView
import Layout from "@/layouts/Layout.astro";

export function getStaticPaths() {
  const paths: any[] = [];
  // Wir brauchen hier Zugriff auf die Keys.
  // Da viewConfig in registry jetzt privat ist, exportieren wir routeSlugs,
  // das reicht meistens, oder wir exportieren keys separat.
  // Fürs einfache Beispiel nutzen wir routeSlugs als Quelle der Wahrheit für existierende Seiten:
  const allRouteKeys = Object.keys(routeSlugs).concat("home");

  allRouteKeys.forEach((routeKey) => {
    languages.forEach((lang) => {
      let slugParam: string | undefined;
      const isDefaultLang = lang === defaultLang;

      if (routeKey === "home") {
        slugParam = isDefaultLang ? undefined : lang;
      } else {
        const slugs = routeSlugs[routeKey];
        if (!slugs) return;

        const pageSlug = slugs[lang];
        if (pageSlug) {
          slugParam = isDefaultLang ? pageSlug : `${lang}/${pageSlug}`;
        }
      }

      paths.push({
        params: { slug: slugParam },
        props: { lang, routeKey },
      });
    });
  });

  return paths;
}

const { lang, routeKey } = Astro.props;

// --- HIER IST DIE ÄNDERUNG ---
const view = getView(routeKey, lang);

if (!view) {
  return Astro.redirect("/404");
}

const { Component, t } = view;
// -----------------------------
---

<Layout
  title={t.seo?.title || "Beckernet.es"}
  description={t.seo?.description || ""}
  lang={lang}
  routeKey={routeKey}
>
  <Component lang={lang} t={t} />
</Layout>
