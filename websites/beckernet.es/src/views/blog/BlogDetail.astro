---
import Container from "@/components/ui/Container.astro";
import { imageUrl } from "@/lib/cms";
import { resolveTranslations, type Language } from "@/lib/i18n";
import { getTranslatedPath } from "@/lib/registry";
import type { BlogPost, BlogPostCategory } from "@pulpo/cms";
import { Icon } from "astro-icon/components";
import { marked } from "marked";

type Props = {
  lang: Language;
  post: BlogPost;
  category: BlogPostCategory;
};

const { post, lang, category } = Astro.props;

const categoryRouteKey = `blog_category_${category.id}`;
const categoryHref = getTranslatedPath(categoryRouteKey, lang);

const t = resolveTranslations(post, lang);
const contentHtml = t.content ? await marked.parse(String(t.content)) : "";
---

<article class="py-24 sm:py-32">
  <Container class="max-w-4xl">
    <!-- ZurÃ¼ck Link -->
    <a
      href={categoryHref}
      class="inline-flex items-center gap-2 text-text-muted hover:text-white mb-12 text-sm uppercase tracking-widest transition-colors"
    >
      <Icon name="lucide:arrow-left" class="w-4 h-4" />
      {category.title}
    </a>

    <!-- Header -->
    <header class="mb-12 text-center">
      <span
        class="text-secondary font-bold tracking-widest uppercase text-sm mb-6 block"
      >
        {new Date(post.date).toLocaleDateString(lang)}
      </span>
      <h1
        class="text-4xl md:text-6xl font-serif text-white mb-8 leading-tight text-balance"
      >
        {t.title}
      </h1>
    </header>

    <!-- Main Image -->
    {
      post.image && (
        <div class="aspect-video w-full overflow-hidden mb-16 border border-border">
          <img
            src={imageUrl(post.image.id, 1200)}
            alt={t.title + ""}
            class="w-full h-full object-cover"
          />
        </div>
      )
    }

    <!-- Content -->
    <div
      class="prose prose-lg prose-invert prose-headings:font-serif prose-headings:text-white prose-p:text-text-muted prose-a:text-secondary mx-auto"
    >
      <div set:html={contentHtml} />
    </div>
  </Container>
</article>
