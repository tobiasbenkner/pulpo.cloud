---
import { imageUrl } from "@/lib/cms";
import Container from "@/components/ui/Container.astro";
import { resolveTranslations, defaultLang } from "@/lib/i18n";
import type { BlogPostCategory } from "@pulpo/cms";

interface Props {
  lang: string;
  category: BlogPostCategory;
  title: string;
}
const { lang, category, title } = Astro.props;
const posts = category.posts || [];

const currentCategorySlug = resolveTranslations(category.slug, lang);
---

<section class="py-24 sm:py-32">
  <Container>
    <h1 class="text-4xl md:text-5xl font-serif text-white mb-16">{title}</h1>

    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12"
    >
      {
        posts.map((post) => {
          // Wir suchen die Übersetzung passend zur aktuellen Sprache
          // Falls dein CMS Objektstruktur { title: {es: '...', en: '...'} } hat:
          // const postTitle = resolveTranslations(post.title, lang);

          // Falls dein CMS Array-Struktur hat (Directus Standard für Relational):

          // URL bauen:
          // 1. Post Slug holen
          const postSlug = resolveTranslations(post.slug, lang);

          // 2. Prefix bauen
          const isDefault = lang === defaultLang;
          const urlPrefix = isDefault ? "" : `/${lang}`;

          // 3. Zusammenfügen: /es/blog/kategorie-slug/post-slug
          const href = `${urlPrefix}/blog/${currentCategorySlug}/${postSlug}`;

          return (
            <a href={href} class="group block">
              <div class="aspect-16/10 overflow-hidden bg-surface mb-6 border border-border group-hover:border-secondary transition-colors">
                {post.image?.id && (
                  <img
                    src={imageUrl(post.image.id)}
                    alt={post.title[lang]}
                    class="w-full h-full object-cover"
                  />
                )}
              </div>
              <div class="flex items-center gap-3 text-xs font-bold uppercase tracking-widest text-secondary mb-3">
                {new Date(post.date).toLocaleDateString(lang)}
              </div>
              <h2 class="text-2xl font-serif text-white mb-3 group-hover:text-secondary transition-colors">
                {post.title[lang]}
              </h2>
              <p class="text-text-muted line-clamp-3 leading-relaxed">
                {post.excerpt[lang]}
              </p>
            </a>
          );
        })
      }
    </div>
  </Container>
</section>
